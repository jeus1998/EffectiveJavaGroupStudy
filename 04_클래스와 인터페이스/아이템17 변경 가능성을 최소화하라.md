## 17. 변경 가능성을 최소화하라
### 함수형 프로그래밍
- **함수형 프로그래밍** 이란?
    - 거의 모든 것을 순수 함수로 나누어 문제를 해결하는 기법
        - 작은 문제를 해결하기 위한 함수를 작성
    - 대입문이 없는 프로그래밍
        ```java
        //1. 명령형
        for(int i = 1 ; i < 10; i++){
            System.out.println(i);
        }
        
        //2. 선언형(함수형)
        process(10, print(num));
        ```
    - 피연산자에 함수 적용하여 결과 반환
        - 하지만 피연산자는 값이 변하지 않음
- 함수형 프로그램 작성으로 **불변 영역이 높아지는 효과**를 얻을 수 있다.

### 가변 객체와 불변 객체
- 가변 객체는 **복잡한 상태**에 놓을 수 있다
    - setter와 같은 변경자 메서드가 상태 변이를 일으키는 내역을 모조리 문서에 담지 않는 이상 믿을 수 없을 수 있다.
    - ex. ‘변하지 않을까? 이전과 동일할까?’
- 불변 객체는 근본적으로 ***스레드 안전***하여 따로 ***동기화*** 될 필요가 없어서 안심하고 공유할 수 있다.
    - 스레드 안전하여 : 어느 스레드든 **각각의 스레드에서 안전하게 사용**될 수 있고 **다른 스레드에 영향을 주거나 영향을 받아 훼손되지 않는다.**
    - 동기화 : 값을 업데이트 해주고 **싱크를 맞춰주는 작업**

### 불변 객체 특징
- 불변 객체는 늘 값이 같기 때문에 **방어적 복사가(=clone메서드나 복사 생성자) 필요하지 않음**
    - String의 복사 생성자는 불필요한 기능임
- 불변 객체는 자유롭게 공유할 수 있고 **불변 객체끼리 내부 데이터를 공유할 수 있음**
    - 불변 이니까 배열이 가변 객체긴 하지만 불변끼리 공유는 바뀔 일이 (가능성이) 없어 공유할 수 있다
- 객체를 만들 때 다른 불변 객체들을 구성 요소로 사용하면 아무리 **복잡한 구조더라도 불변식을 유지하기 수월**하다
    - **불변 객체는 맵의 키와 집합(Set)의 원소로 쓰기에 안성맞춤**이다
        - 맵이나 집합은 안에 담긴 값이 바뀌면 불변식이 허물어 진다
            - 맵과 집합은 중복이 허용되지 않고 순서가 있음
                - 만약 안에 담긴 값이 바뀐다면, 중복 체크 및 순서 재배치를 매번 검사 해줄 필요가 있음
            - 이 때 불변 객체를 사용하면 위와 같은 걱정은 해주지 할 필요가 없음
- 불변 객체는 그 자체로 **실패 원자성을 제공**한다
    - 실패 원자성: 실패 시 이전 상태로 돌아가는 것으로, **예외 발생 후에도 전과 같은 유효한 상태여야 하는 것**
- 단점 : 값이 다르면 독립된 객체로 만들어야 하기 때문에 값의 가짓수가 많으면 모든 경우를 다 만들어야 될 수 있어 비용이 더 많이 든다.
### 불변 클래스 만들기
- 단계를 갖고 이루어지는 연산이 있다면 **이를 예측하고 기본 기능으로 제공하여 단계마다 객체를 생성하지 않도록** 한다.
- **생성자를 (package-)private**으로 두고 **public 정적 팩토리 메서드**로 객체를 만들 수 있도록 하기
  - 이렇게 되면 하위에서 상위 클래스 생성자에 접근 할 수 없기 때문에 하위 클래스 생성 불가
  - 신뢰할 수 없는 하위 클래스의 인스턴스라고 확인되면 이 인수들은 가변이라 가정하고 방어적으로 복사해 사용해야 된다.
- **불변으로 만들 수 없는 클래스라도 변경 할 수 있는 부분을 최소화** 하자
  - 객체가 가질 수 있는 상태의 수를 줄인다
  - 합당한 이유가 없다면 모든 필드는 private final 이어야 한다
